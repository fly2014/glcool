<!DOCTYPE html>
<html lang="zh-CN" class="no-js"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script><title>数据库 – GlCool</title><link rel="dns-prefetch" href="//s.w.org"><link rel="stylesheet" id="wp-block-library-css" href="https://www.glcool.com/wp-includes/css/dist/block-library/style.min.css" media="all"><link rel="stylesheet" id="wp-block-library-theme-css" href="https://www.glcool.com/wp-includes/css/dist/block-library/theme.min.css" media="all"><link rel="stylesheet" id="genericons-css" href="https://www.glcool.com/wp-content/themes/twentyfifteen/genericons/genericons.css" media="all"><link rel="stylesheet" id="twentyfifteen-style-css" href="https://www.glcool.com/wp-content/themes/twentyfifteen/style.css" media="all"><link rel="stylesheet" id="twentyfifteen-block-style-css" href="https://www.glcool.com/wp-content/themes/twentyfifteen/css/blocks.css" media="all"><script src="https://www.glcool.com/wp-includes/js/jquery/jquery.js"></script><script src="https://www.glcool.com/wp-includes/js/jquery/jquery-migrate.min.js"></script></head><body class="archive category category-8 wp-embed-responsive">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">跳至内容</a>

	<div id="sidebar" class="sidebar">
		<header id="masthead" class="site-header" role="banner"><div class="site-branding">
										<p class="site-title"><a href="https://www.glcool.com/" rel="home">GlCool</a></p>
												<p class="site-description">The Global Coolest</p>
										<button class="secondary-toggle">菜单和挂件</button>
			</div>
		</header><div id="secondary" class="secondary">

		
		
					<div id="widget-area" class="widget-area" role="complementary">
						<aside id="recent-posts-2" class="widget widget_recent_entries"><h2 class="widget-title">近期文章</h2>		<ul><li>
					<a href="https://www.glcool.com/archives/362">DbContext与IOC与多线程</a>
									</li>
											<li>
					<a href="https://www.glcool.com/archives/360">WPF 与 IOC与Nlog</a>
									</li>
											<li>
					<a href="https://www.glcool.com/archives/346">LINUX常用命令</a>
									</li>
											<li>
					<a href="https://www.glcool.com/archives/343">GIT常用命令</a>
									</li>
											<li>
					<a href="https://www.glcool.com/archives/313">windows10-tensorflow2安装</a>
									</li>
					</ul></aside><aside id="pages-2" class="widget widget_pages"><h2 class="widget-title">页面</h2>		<ul><li class="page_item page-item-315"><a href="https://www.glcool.com/about">关于</a></li>
		</ul></aside><aside id="categories-3" class="widget widget_categories"><h2 class="widget-title">分类目录</h2>		<ul><li class="cat-item cat-item-2"><a href="https://www.glcool.com/archives/category/iot">IOT</a>
</li>
	<li class="cat-item cat-item-52"><a href="https://www.glcool.com/archives/category/linux">Linux</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://www.glcool.com/archives/category/net">NET</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://www.glcool.com/archives/category/php">PHP</a>
</li>
	<li class="cat-item cat-item-5"><a href="https://www.glcool.com/archives/category/tensorflow">TensorFlow</a>
</li>
	<li class="cat-item cat-item-6"><a href="https://www.glcool.com/archives/category/windows">Windows</a>
</li>
	<li class="cat-item cat-item-7"><a href="https://www.glcool.com/archives/category/blockchain">区块链</a>
</li>
	<li class="cat-item cat-item-8 current-cat"><a aria-current="page" href="https://www.glcool.com/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93">数据库</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://www.glcool.com/archives/category/uncategorized">未分类</a>
</li>
	<li class="cat-item cat-item-9"><a href="https://www.glcool.com/archives/category/%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97">消息队列</a>
</li>
		</ul></aside></div>
		
	</div>

	</div>

	<div id="content" class="site-content">

	<section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">分类：数据库</h1>			</header><article id="post-362" class="post-362 post type-post status-publish format-standard hentry category-net category-8 tag-dbcontext tag-ioc tag-56"><header class="entry-header"><h2 class="entry-title"><a href="https://www.glcool.com/archives/362" rel="bookmark">DbContext与IOC与多线程</a></h2>	</header><div class="entry-content">
		<p>1、先看报错日志：</p>
<pre> An exception occurred while iterating over the results of a query for context type 'Mes.Data.MesContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryingEnumerable`1.Enumerator.MoveNext() A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.|Microsoft.EntityFrameworkCore.Query|contextType=Mes.Data.MesContext, newline=
, error=System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see <span style="color: #ff0000;">https://go.microsoft.com/fwlink/?linkid=2097913</span>.</pre>
<p>微软官方明确不支持多线程，真是败笔。不支持单例复用。每次都是需要实例化（不用担心资源消耗问题）。但是前面的IOC 仓储代码需要丢弃，这好蛋疼<br>
2、解决方案看代码：</p>
<pre>public class ServiceLocator
    {
        public static IServiceProvider Services { get; private set; }
        public static void SetServices(IServiceProvider services)
        {
            Services = services;
        }
        public static T GetService()
        {
            return Services.GetService();
        }
    }
</pre>
<pre>
services.AddDbContext<MesContext>(options =>
{
options.UseSqlServer(hostContext.Configuration.GetConnectionString("Mes")).UseLoggerFactory(NLoggerFactory).UseQueryTrackingBehavior(QueryTrackingBehavior.NoTracking);
},<span style="color: #ff0000;">ServiceLifetime.Transient</span>);                    
ServiceLocator.SetServices(services.BuildServiceProvider());
//注意其他仓储，服务层全部注册为ServiceLifetime.Transient模式
//调用代码（多线程里面每次需要调用，不能复用，没有测试性能问题）：
//_isysOpcCodeService = ServiceLocator.GetService<IsysOpcCodeService>();
//_isysOpcCodeService.GetAll().Take(3).ToList();
</pre>
	</div>

	
	<footer class="entry-footer"><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="https://www.glcool.com/archives/362" rel="bookmark"><time class="entry-date published updated" datetime="2020-08-31T11:42:23+08:00">2020年8月31日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="https://www.glcool.com/archives/category/net" rel="category tag">NET</a>、<a href="https://www.glcool.com/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93" rel="category tag">数据库</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="https://www.glcool.com/archives/tag/dbcontext" rel="tag">DbContext</a>、<a href="https://www.glcool.com/archives/tag/ioc" rel="tag">IOC</a>、<a href="https://www.glcool.com/archives/tag/%e5%a4%9a%e7%ba%bf%e7%a8%8b" rel="tag">多线程</a></span><span class="comments-link"><a href="https://www.glcool.com/archives/362#respond"><span class="screen-reader-text">于DbContext与IOC与多线程</span>留下评论</a></span>			</footer></article><article id="post-292" class="post-292 post type-post status-publish format-standard hentry category-8 tag-debian9 tag-mariadb"><header class="entry-header"><h2 class="entry-title"><a href="https://www.glcool.com/archives/292" rel="bookmark">debian9安装mariadb导致密码无效问题</a></h2>	</header><div class="entry-content">
		<p>debian9默认就是mariadb这个数据库，mysql一样<br>
sudo apt install mariadb-server<br>
sudo -i<br>
mysql -u root -p<br>
1 use mysql;   然后敲回车<br>
2 update user set authentication_string=password(“你的密码”) where user=”root”  然后敲回车<br>
3 flush privileges  然后敲回车上面操作都没有用的<br>
#select user,plugin from user后看看，错误原因是因为plugin root的字段是auth_socket，那我们改掉它为下面的mysql_native_password<br>
update user set authentication_string=password(“123456”),plugin=’mysql_native_password’ where user=’root’;<br>
flush privileges;<br>
到处都是坑<br>
参考：http://blog.sina.com.cn/s/blog_7c987bee0102yz76.html</p>
	</div>

	
	<footer class="entry-footer"><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="https://www.glcool.com/archives/292" rel="bookmark"><time class="entry-date published" datetime="2019-08-02T17:35:56+08:00">2019年8月2日</time><time class="updated" datetime="2020-05-28T13:19:29+08:00">2020年5月28日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="https://www.glcool.com/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93" rel="category tag">数据库</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="https://www.glcool.com/archives/tag/debian9" rel="tag">debian9</a>、<a href="https://www.glcool.com/archives/tag/mariadb" rel="tag">mariadb</a></span><span class="comments-link"><a href="https://www.glcool.com/archives/292#respond"><span class="screen-reader-text">于debian9安装mariadb导致密码无效问题</span>留下评论</a></span>			</footer></article><article id="post-276" class="post-276 post type-post status-publish format-standard hentry category-8 tag-centos7 tag-influxdb tag-45"><header class="entry-header"><h2 class="entry-title"><a href="https://www.glcool.com/archives/276" rel="bookmark">时序数据库InfluxDB在centos7安装使用</a></h2>	</header><div class="entry-content">
		<p>安装过程:<br>
curl -O https://dl.influxdata.com/influxdb/releases/influxdb-1.7.7.x86_64.rpm<br>
yum install influxdb-1.7.7.x86_64.rpm<br>
systemctl start influxdb<br>
systemctl status influxdb<br>
配置安全选项<br>
vim /etc/influxdb/influxdb.conf<br>
[http]<br>
enabled = true<br>
bind-address = “:8086”<br>
auth-enabled = true<br>
log-enabled = true<br>
https暂不开启<br>
登录<br>
influx -precision rfc3339<br>
有密码登录<br>
influx -precision rfc3339 -username ‘admin’ -password ‘admin’<br>
设置密码（必须登录，先停止安全配置，重启influxdb）<br>
CREATE USER admin WITH PASSWORD ‘<password>‘ WITH ALL PRIVILEGES<br>
数据库连接使用<br>
NET:https://github.com/influxdata/influxdb-java<br>
java：https://github.com/AdysTech/InfluxDB.Client.Net</password></p>
	</div>

	
	<footer class="entry-footer"><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="https://www.glcool.com/archives/276" rel="bookmark"><time class="entry-date published" datetime="2019-07-04T16:35:19+08:00">2019年7月4日</time><time class="updated" datetime="2020-05-28T13:21:54+08:00">2020年5月28日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="https://www.glcool.com/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93" rel="category tag">数据库</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="https://www.glcool.com/archives/tag/centos7" rel="tag">CentOS7</a>、<a href="https://www.glcool.com/archives/tag/influxdb" rel="tag">InfluxDB</a>、<a href="https://www.glcool.com/archives/tag/%e6%97%b6%e5%ba%8f%e6%95%b0%e6%8d%ae%e5%ba%93" rel="tag">时序数据库</a></span><span class="comments-link"><a href="https://www.glcool.com/archives/276#respond"><span class="screen-reader-text">于时序数据库InfluxDB在centos7安装使用</span>留下评论</a></span>			</footer></article><article id="post-270" class="post-270 post type-post status-publish format-standard hentry category-8 tag-centos7 tag-mysql5-6"><header class="entry-header"><h2 class="entry-title"><a href="https://www.glcool.com/archives/270" rel="bookmark">Centos7安装mysql5.6</a></h2>	</header><div class="entry-content">
		<p><code>wget http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64//mysql-community-release-el7-5.noarch.rpm<br>
rpm -Uvh mysql-community-release-el7-5.noarch.rpm<br>
yum install mysql-community-server<br>
systemctl start mysql<br>
systemctl status mysql<br>
mysql -u root<br>
use mysql;<br>
update user set password=PASSWORD("root") where User='root';<br>
update user set host='%' where Host='localhost' and User='root';<br>
flush privileges;</code></p>
	</div>

	
	<footer class="entry-footer"><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="https://www.glcool.com/archives/270" rel="bookmark"><time class="entry-date published" datetime="2019-06-25T13:36:10+08:00">2019年6月25日</time><time class="updated" datetime="2020-05-28T13:21:54+08:00">2020年5月28日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="https://www.glcool.com/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93" rel="category tag">数据库</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="https://www.glcool.com/archives/tag/centos7" rel="tag">CentOS7</a>、<a href="https://www.glcool.com/archives/tag/mysql5-6" rel="tag">mysql5.6</a></span><span class="comments-link"><a href="https://www.glcool.com/archives/270#respond"><span class="screen-reader-text">于Centos7安装mysql5.6</span>留下评论</a></span>			</footer></article><article id="post-264" class="post-264 post type-post status-publish format-standard hentry category-8 tag-mysql"><header class="entry-header"><h2 class="entry-title"><a href="https://www.glcool.com/archives/264" rel="bookmark">mysql压缩版安装</a></h2>	</header><div class="entry-content">
		<p>1、解压到一个目录,修改配置文件</p>
<pre>my-default.ini
basedir =E:\ProgramFiles\mysql-5.6.43-winx64
datadir =E:\ProgramFiles\mysql-5.6.43-winx64\data
port =3306</pre>
<p>管理员打开CMD命令</p>
<pre>mysqld -install
mysqladmin -u root -p password malong#修改密码
mysqld -remove
net stop mysql
mysql -u root -p
</pre>
<p>use mysql;报错<br>ERROR 1044 (42000): Access denied for user ”@’localhost’ to database ‘mysql<br>mysql -u root -p<br>换下面方式，为什么？权限问题？我也不懂<br>mysql -uroot -p<br>mysqladmin -uroot -p123 password 123123<br>修改密码后2种方式登录就没有关系了</p>


<p>show databases; </p>



<p>use mysql;</p>



<p>UPDATE user SET password=PASSWORD(“123456”) WHERE user=’root’;</p>



<p>FLUSH PRIVILEGES; </p>
	</div>

	
	<footer class="entry-footer"><span class="posted-on"><span class="screen-reader-text">发布于 </span><a href="https://www.glcool.com/archives/264" rel="bookmark"><time class="entry-date published" datetime="2019-06-15T11:56:15+08:00">2019年6月15日</time><time class="updated" datetime="2020-05-28T13:21:54+08:00">2020年5月28日</time></a></span><span class="cat-links"><span class="screen-reader-text">分类 </span><a href="https://www.glcool.com/archives/category/%e6%95%b0%e6%8d%ae%e5%ba%93" rel="category tag">数据库</a></span><span class="tags-links"><span class="screen-reader-text">标签 </span><a href="https://www.glcool.com/archives/tag/mysql" rel="tag">mysql</a></span><span class="comments-link"><a href="https://www.glcool.com/archives/264#respond"><span class="screen-reader-text">于mysql压缩版安装</span>留下评论</a></span>			</footer></article></main></section></div>

	<footer id="colophon" class="site-footer" role="contentinfo"><div class="site-info">
									<a class="imprint">2020-02-02--@github
			</a>
		</div>
	</footer></div>

<script src="https://www.glcool.com/wp-content/themes/twentyfifteen/js/skip-link-focus-fix.js"></script><script>
var screenReaderText = {"expand":"<span class=\"screen-reader-text\">\u5c55\u5f00\u5b50\u83dc\u5355<\/span>","collapse":"<span class=\"screen-reader-text\">\u6298\u53e0\u5b50\u83dc\u5355<\/span>"};
</script><script src="https://www.glcool.com/wp-content/themes/twentyfifteen/js/functions.js"></script></body></html>
